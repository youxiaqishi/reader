<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,minimal-ui">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="../static/css/reset.css">
	<style type="text/css">
	   html{
	   	width: 100%;
	   	height: 100%;
	   	overflow-x:hidden;
	   }
		body{
			text-align: left;
			background: #e9dfc7;
			width: 100%;
			overflow: hidden;
		}
		.m-read-content{
			font-size: 14px;
			color: #555;
			line-height: 31px;
			padding: 15px;
			margin: 0 0 1em 0;
		}
		.m-read-content h4{
			font-size: 20px;
			color: #736357;
			border-bottom: solid 1px #736357;
			letter-spacing: 2px;
		}
		.m-read-content p{
			text-indent: 2em;
			margin: 0.5em 0;
			letter-spacing: 0px;
			line-height: 24px;
		}
		.u-tab{
			height: 34px;
			margin: 10px auto;
			line-height: 34px;
			border-radius: 8px;
			border: 1px solid #858382;
			font-size: 12px;
			background: #000;
			opacity: 0.9;
		}
        .u-tab li{
           display: inline-block;
           width: 49%;
           border-right: 1px solid #858382;
           text-align: center;
           color: #fff;
        }
        .u-tab li:nth-child(2){
        	border-right: none;
        }
        .m-button-bar{
        	width: 70%;
        	max-width: 800px;
        	margin: 10px auto;
        	padding: 5px;
        	cursor: pointer;
        }
        @font-face{
        	font-family: 'icons';
        	src:url('../static/css/ico.woff') format('woff');
        	font-weight: normal;
        	font-size: normal;
        }
        .top-nav{
        	position: fixed;
        	top: 0px;
        	height: 50px;
        	width: 100%;
        	z-index: 999;
        	background: #000;
        }
        .icon-back:after{
        	content:"\ea44";
        	font-family: 'icons';
        	font-size: 20px;
        	color: #d5d5d5;
        }
        .icon-back{
        	position: absolute;
        	top: 14px;
        	left: 10px;
        	width: 23px;
        }
        .nav-title{
           position: absolute;
           top: 16px;
           left: 42px;
           color: #d5d5d5;
        }
        .nav-bottom{
        	z-index: 999;
        	bottom: 0px;
        	position: fixed;
        	width: 100%;
        	height: 70px;
        	background: #000;
        	text-align: center;
        	margin: 0 auto;
        	opacity: 0.9;
        }
        .item{
         /* position:absolute;*/ 
          /*bottom: -5px; */
          /*margin-bottom: -5px;*/
          display: inline-block;
          width: 32%;
          color: #fff;
          text-align: center;
          margin: 0 auto;
          background: none;
        }
        .item-wrap{
        	width: 26px;
        	margin: 0 auto;
        	position: relative;
        	background: none;
        }
        .icon-text{
        	position: absolute;
        	top: 30px;
        	font-size: 10px;
        }
        .icon-menu, .icon-ft, .icon-night, .icon-day{
        	position: absolute;
        	top: 3px;
        	left: 2px;

        }
        .icon-ft{
        	margin-top: -3px;
        }
        .icon-menu:after{
          content: "\e9bb";
          font-family:'icons';
          color: #d5d5d5;
          font-size: 20px;
        }
        .icon-ft:after{
          content: "\ea6d";
          font-family:'icons';
          color: #d5d5d5;
          font-size: 30px;
          /*margin-bottom: -2px;*/
        }
        .icon-night{
          width: 18px;
          height: 18px;
          background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkU2OUYzRUEwMjc4NzExRTU5RkYxQjg1Rjk2QkEyNzBEIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjhBMzA2RjA2Mjc4QTExRTU5RkYxQjg1Rjk2QkEyNzBEIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RTY5RjNFOUUyNzg3MTFFNTlGRjFCODVGOTZCQTI3MEQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RTY5RjNFOUYyNzg3MTFFNTlGRjFCODVGOTZCQTI3MEQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4v5YACAAAC/UlEQVR42tSaXYhNURTH97kzRnJ9ZTQzPh7IMEr5yshHEwkRkSeSjweEiMjDePTkhcKLPCApUV54GxTKcDM0JfL9QE0UGdcdEmb7L3edOq5zzz1nn332Pvdfv5e5Z9Zd666711577etIKYUGjQILwRwwDOwDfcKAamP873CwBawDrcABP8ACU87/FWUgIk3gKMjL/7VfwV4sojxcCw6AL9JfD0DGdABhv0KTwAUwO+CZvaBfGFaYAJaDyyAb8Mwt0CksKFPh9W3gWgXnSSeFJTkBZXQrOM3VJUi9oJErUGoysBKcCuE86YYt58sF0MILtiakjTvCojI+i/o876Zh9ThNARysUCr99NpmAN5FTAvxBRgS0QZlK5+GDLQrOC9sOu/NADVm70LU+9RmYJOi8yLigk8sgPUxbEy0HUATH0RUNdV2AG0hd9xyarMdwNyYNhaDOpsBTI5pYwRYYTMAHYtwh80ARmqws1ShBdEWwGAdGyI4HrMYKAegawFSMdhlo5XIK/ZAfvoO5oFukxn4oNHeID5DjzUZwCvNNsn5DjDOVADPErA7BdwF0xP2v4YCyCVknDJwjxe2k8AHT4O0VTSeawD9Mll1glZN48T5IMc+N7p/7JJm1AFWg4ERna4Da8F1j62cdzZKY5RZBtbcEuYzuAlugyfgOSjwyS7LJ8QJYJoojuuX+RycLnqPlPXgLZfBalCB11iveyL7CM6K6tEZURxp/jNWGc2pzFbBp98M3peOVXrA4Sr49I+4zpdmgDSA94UZKXX+ITeNP8sFIDg9XWBoypyni0O6THzqN1bx6iXYCH6nyHnyZXOp8+UCIF0Fe1LiPH1FdoMr/q8G74DbwS9pT/TeO+Nes64JuFpNUl+5fdByT9wMHhl0vhu06L7opobqEPiWoON9oJ0v1bXf1LuMAcdAQbPjJ6g9juqPE+PXKvVcbjeAmQqHFsmb5iVwzu1tVKYSOkpdA1jEU246To4XxZ/gZLlUU5v8CbzhI+x9bqV74r7xHwEGAPDRVwnecW5KAAAAAElFTkSuQmCC);
          background-size: contain;
        }
        .icon-day{
        	width: 20px;
        	height: 20px;
        	background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADkAAAA5CAYAAACMGIOFAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkNFN0E3M0I0Mjc4NDExRTU5RkYxQjg1Rjk2QkEyNzBEIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkNFN0E3M0I1Mjc4NDExRTU5RkYxQjg1Rjk2QkEyNzBEIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Q0U3QTczQjIyNzg0MTFFNTlGRjFCODVGOTZCQTI3MEQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Q0U3QTczQjMyNzg0MTFFNTlGRjFCODVGOTZCQTI3MEQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6o6V5PAAADu0lEQVR42uyaTUgVURTHm/cigiS1LEitoHoqbgtcZAStngtDoYxa9rFsYYuWfUBhuSjCneiylkH2oavoEZlC4aYsM9toakWLnpsWyfQfOMJrOvdjZs6bedQc+OF7d9499/y9M/fj3HFc110Xo3WAYfp8BozG0agTs8hFsIM+L4H6f1GkvzEnjkYz6/4DS0WmIlORSlsq+bxcKSI3gkHwBlwSGA3PkrjPNE+GnhXAZYprkOLUjOmYQjT0un/aMHAMdcqNQ3GUWq+ujqknt/i+nwZDcc1vih4cojh0cQbqyQaw4P5tSfQo14OezYNGXV0b5zly5Le+mEX2KQTmTHVtl3U58BQ0lpQtgJ2Gei2gE7SDVrANVIMf4Bt4B56Dh+C9wdc80/4RMGteTNr/J/09+lhzW3WBCTeYTVA91WPwKGgPBrldS9kFBkA/qGOuN4FnbjTz6jczvuuoXa/93UHilnxmjoMVV8ZWyJ9IbFICz4FVV9ZWyW9FiDwGfmmCnQIXQBuoBxvobxuVT2nqen57khbpPYNFRYBzoNtiPnXod3MKP0VqJxGRjmaQGQXVAf1VUz3VYOQkIbJLEdADkA3pM0v1OetKQuQ4E8gHUBXxEfDqzzC+x+MW2aL4b+eFRuu8wn9LGH9hN82dTNlrMCa02xgjf347GmdmoJ0puyu8rbrHlB2MU2QrUzYuLLJg2a6VyA7KbLsMi3Tdb9sVuwRJ+2TZrjF+b+4pTd2rkk/1hky4Z+vBapkz7lzW3Ri/ze3KpTqKTNlmYYG1TNlKmJRJpiSDxpkqq/aVKdsrLHIPU/ZFkwFUxu/dYk8M3c3ZNNjnKzsEXgmKPKxo12/G+MOOri+YslPCPXnSst2yTSEjTNkBkBcSmCd/Nu1aDF/hl15cDmdGYO26SXrtGuUs5AZT1kQrn2xIn1la6TQx1/rDT0TR9pMFxUL6fogeraJ6nBWS2k+uZQZUyauPtOO38dNNv1cltZqTzvH0WOZ49oMaqlND321yPCfSbF2ad5UXufaMFiIKLER9BqOK9Ea4m2CZEk61mrOQyYDiJjUpzFpqb5nad8olkjsfvG6RC7oIRsBsSY62SN9H6Lopd3MtyvmorcCM4gD0dkxnk7eiHARHEWg84RWkUXPinZEQeSXsCa8wOYXQqxIi31aAQN3R/rTEAv1lqCNs3taSTqoEmclmqf2FIFlCm3cGvBeBzoOt4I7vraqgJvW+awPF9B0MgJ9RRZYz+5a+75qKTEWmIstuFfm+q7RJve8ayH4LMACaxEJEaXs23AAAAABJRU5ErkJggg==);
        	background-size: contain;
        }
        .nav-pannel-bk{
        	position: fixed;
        	bottom: 70px;
        	height: 135px;
        	width: 100%;
        	background: #000;
        	opacity: 0.9;
        	z-index: 10000;
        	/*padding-bottom: 2px;*/
        }
        .nav-pannel{
        	position: fixed;
        	bottom: 70px;
        	height: 135px;
        	width: 100%;
        	background: none;
        	color: #fff;
        	z-index: 10001;
        	/*padding-bottom:2px; */
        }
        .child-mod{
        	padding: 5px 10px;
        	margin:15px;
        }
        .child-mod span{
        	display: inline-block;
        	padding-right: 20px;
        	padding-left:10px; 
        }
        .font-size-button{
        	background: none;
        	border:1px #8c8c8c solid;
        	color: #fff;
        	border-radius: 16px;
        	padding: 5px 40px;
        }
        .child-mod button:nth-child(2){
        	margin-right:10px; 
        }
        .bk-container{
        	position: relative;
        	width: 30px;
        	height: 30px;
        	border-radius: 50%;
        	background: #e9dfc7;
        	display: inline-block;
        	vertical-align: middle;
        	margin:0 5px;
        }
        .bk-container:nth-of-type(2){
            background: #a4a4a4;
        }
        .bk-container:nth-of-type(3){
        	background: #cdedce;
        }
        .bk-container:nth-of-type(4){
        	background: #283548;
        }
        .bk-container:nth-of-type(5){
        	background: #0f1410;
        }

        .bk-container-current{
        	position: absolute;
        	width: 32px;
        	height: 32px;
        	border-radius: 50%;
        	border: 1px #ff7800 solid;
        	display: inline-block;
        	top: -2px;
        	left: -2px;
        }
        .artical-action-mid{
        	position: fixed;
        	z-index: 10002;
        	width: 100%;
        	height: 40%;
        	top: 30%;
        }
/*        .current{
        	color: red;
        }*/
        .fiction_list a{
            display: block;
            width: 100%;
            height: 50px;
            font-size: 20px;
            /*background: red;*/
            border-bottom: 1px solid #fff;
            text-decoration: none;
            /*text-align: left;*/
            line-height: 50px;
            text-indent: 0.5em;
            color: #000;

        }
/*        .prev_button, .next_button{
        	cursor: pointer;
        }*/
	</style>
</head>
<body>
    <div id="root" class="container">
        <div class="m-artical-action">
            <div class="artical-action-mid" id="action-mid"></div>
        </div>
        <div id="top-nav" class="top-nav" style="display:none">
        	<div class="icon-back"></div>
        	<div class="nav-title">返回书架</div>
        </div>
    	<div id="fiction_chapter_title"></div>
        <div id="fiction_list" class="fiction_list" style="display:none">
            <ul>
                <li><a href="#">第001章&nbsp;&nbsp; 死都要成名</a></li>
                <li><a href="#">第002章&nbsp;&nbsp; 十年卖身契</a></li>
                <li><a href="#">第003章&nbsp;&nbsp; 没钱就滚！</a></li>
                <li><a href="#">第004章&nbsp;&nbsp; 绝处逢生？</a></li>
                <li><a href="#">第005章&nbsp;&nbsp; 救命的稻草</a></li>
                <li><a href="#">第001章&nbsp;&nbsp; 死都要成名</a></li>
                <li><a href="#">第002章&nbsp;&nbsp; 十年卖身契</a></li>
                <li><a href="#">第003章&nbsp;&nbsp; 没钱就滚！</a></li>
                <li><a href="#">第004章&nbsp;&nbsp; 绝处逢生？</a></li>
                <li><a href="#">第005章&nbsp;&nbsp; 救命的稻草</a></li>
                <li><a href="#">第001章&nbsp;&nbsp; 死都要成名</a></li>
                <li><a href="#">第002章&nbsp;&nbsp; 十年卖身契</a></li>
                <li><a href="#">第003章&nbsp;&nbsp; 没钱就滚！</a></li>
                <li><a href="#">第004章&nbsp;&nbsp; 绝处逢生？</a></li>
                <li><a href="#">第005章&nbsp;&nbsp; 救命的稻草</a></li>
                <li><a href="#">第001章&nbsp;&nbsp; 死都要成名</a></li>
                <li><a href="#">第002章&nbsp;&nbsp; 十年卖身契</a></li>
                <li><a href="#">第003章&nbsp;&nbsp; 没钱就滚！</a></li>
                <li><a href="#">第004章&nbsp;&nbsp; 绝处逢生？</a></li>
                <li><a href="#">第005章&nbsp;&nbsp; 救命的稻草</a></li>
            </ul>
        </div>
        <div id ="fiction_container_area">
        	<div id="fiction_container" class="m-read-content">

        	</div>
        	<div class="m-button-bar">
        		<ul class="u-tab">
        			<li id="prev_button">上一章</li>
        			<li id="next_button">下一章</li>
        		</ul>
        	</div>
        </div>
    	<div class="nav-pannel-bk font-container" style="display:none"></div>
    	<div class="nav-pannel font-container" id="font-container" style="display:none">
    		<div class="child-mod">
    			<span>字号</span>
    			<button id="large-font" class="font-size-button">大</button>
    			<button id="small-font" class="font-size-button">小</button>
    		</div>
    		<div class="child-mod">
    			<span>背景</span>
    			<div class="bk-container" id="bk-container1">
    				<div class="bk-container-current"></div>
    			</div>
    			<div class="bk-container" id="bk-container2">
    				<!-- <div class="bk-container-current"></div> -->
    			</div>
    			<div class="bk-container" id="bk-container3">
    				<!-- <div class="bk-container-current"></div> -->
    			</div>
    			<div class="bk-container" id="bk-container4">
    				<!-- <div class="bk-container-current"></div> -->
    			</div>
    			<div class="bk-container" id="bk-container5">
    				<!-- <div class="bk-container-current"></div> -->
    			</div>
    		</div>
    	</div>
    	<div class="nav-bottom nav_bottom" style="display:none">
           <div class="item" id="menu-button">
           	<div class="item-wrap">
           		<div class="icon-menu"></div>
           		<div class="icon-text">目录</div>
           	</div>
           </div>
           <div class="item" id="font-button">
           	<div class="item-wrap">
           		<div class="icon-ft"></div>
           		<div class="icon-text">字体</div>
           	</div>
           </div>
           <div class="item" id="night-button">
           	<div class="item-wrap" id="icon-day"  style="display:none">
           		<div class="icon-day"></div>
           		<div class="icon-text">白天</div>
           	</div>
           	<div class="item-wrap" id="icon-night">
           		<div class="icon-night"></div>
           		<div class="icon-text">夜间</div>
           	</div>
           </div>
    	</div>
    </div>
    <script src="../static/script/zepto.js"></script>
    <script>
    	window.jQuery = $;
    </script>
    <script src="../static/script/jquery.base64.js"></script>
    <script src="../static/script/jquery.jsonp.js"></script>
    <script>
    	(function(){
    		var Util = (function(){
    			var prefix = 'html5_reader_';
    			var StorageGetter = function(key){
    				return localStorage.getItem(prefix + key);
    			}
    			var StorageSetter = function(key, val){
    				return localStorage.setItem(prefix + key,val)
    			}
    			var getBSONP = function(url, callback){
    				return $.jsonp({
    					url: url,
    					cache: true,
    					callback: 'duokan_fiction_chapter',
    					success: function(result){
    						// debugger
    						var data = $.base64.decode(result);
    						var json = decodeURIComponent(escape(data));
    						callback(json);
    					}
    				})
    			}
    			return{
    				getBSONP:getBSONP,
    				StorageSetter:StorageSetter,
    				StorageGetter:StorageGetter
    			}
    		})();
            var Dom = {
            	top_nav: $('#top-nav'),
            	nav_bottom: $('.nav-bottom'),
                font_container: $('.font-container'),
                font_button: $('#font-button'),
                bk_container:$('.bk-container'),
                body:$('body'),
                night_button: $('#night-button'),
                fiction_list: $('#fiction_list'),
                fiction_container_area:$('#fiction_container_area'),
                action_mid:$('#action-mid')
            }
            // console.log(Dom.body);
            // console.log($('.bk-container'));
            // console.log($('body'));
            var Win = $(window);
            var Doc = $(document);
            var readerModel;
            var readerUI;
            var RootContainer = $('#fiction_container');
            var initFontSize = Util.StorageGetter('font_size');
            initFontSize = parseInt(initFontSize);
            if(!initFontSize){
            	initFontSize = 14;
            }
            RootContainer.css('font-size', initFontSize);

            var oldbackground = Util.StorageGetter('background');
            // if(!oldbackground){
            // 	oldbackground = '#e9dfc7';
            // }
            // console.log(oldbackground);
            Dom.body.css('background', oldbackground);
            // console.log(oldbackground);
    		function main(){
               // 整个项目的入口函数
               readerModel = ReaderModel();
               readerUI = ReaderBaseFrame(RootContainer)
               readerModel.init(function(data){
               	readerUI(data);
               });
               EventHanlder();
    		}
            // $.get('data/data1.json', function(data){
            // 	console.log(data);
            // }, 'json');

    		function ReaderModel(){
               //实现和阅读器相关的数据交互方法
            var Chapter_id;
            var chapterTotal;
            var init = function(UIcallback){
            	getFictionInfo(function(){
            		getCurChapterContent(Chapter_id, function(data){
            			//TODO...
                        UIcallback && UIcallback(data);
            		})
            	})
            }
               var getFictionInfo = function(callback){
               	$.get('/ajax/chapter', function(data){
                    Chapter_id = Util.StorageGetter('last_chapter_id');
                    if(Chapter_id == null){
                    Chapter_id = data.chapters[1].chapter_id;
                   }
                    chapterTotal = data.chapters.length;
                    // console.log(chapterTotal);
                    callback && callback();
               	}, 'json');
               }
               // console.log(chapterTotal);
               var getCurChapterContent = function(chapter_id, callback){
               	$.get('/ajax/chapter_data',{
               		id:Chapter_id
               	}, function(data){
                      if(data.result == 0){
                      	var url = data.jsonp;
                      	Util.getBSONP(url, function(data){
                            // debugger;
                      		callback && callback(data);
                      	})
                      }
               	}, 'json');
               }
               // console.log(chapterTotal);
                var prevChapter = function(UIcallback){
                    Chapter_id = parseInt(Chapter_id, 10);

                    if(Chapter_id == 0){
                        // console.log(1);
                        return;
                    }
                    Chapter_id -= 1;
                    getCurChapterContent(Chapter_id, UIcallback);
                    Util.StorageSetter('last_chapter_id', Chapter_id);

                }
                var nextChapter = function(UIcallback){
                    Chapter_id = parseInt(Chapter_id, 10);
                    if(Chapter_id == chapterTotal){
                        return;
                    }
                    Chapter_id += 1;
                    getCurChapterContent(Chapter_id, UIcallback);
                    Util.StorageSetter('last_chapter_id', Chapter_id);
                }
               return {
               	init: init,
                prevChapter:prevChapter,
                nextChapter:nextChapter
               }
    		}

    		function ReaderBaseFrame(container){
               //渲染基本的UI结构
               function parseChapterData(jsonData){

               	var jsonObj = JSON.parse(jsonData);
               	var html = '<h4>' + jsonObj.t + '</h4>';
               	for(var i = 0; i < jsonObj.p.length; i++){
               		html += '<p>' + jsonObj.p[i] + '</p>'; 
               	}
               	return html;
               }
               return function(data){
               	container.html(parseChapterData(data));
               }
    		}

    		function EventHanlder(){
               //交互的事件绑定
               // console.log($('#action-mid'));
               // Dom.top_nav.show();
               $('#menu-button').css(function(){
               	location.href = "http://dushu.xiaomi.com/fiction/chapter/306450";
               })
               $('#action-mid').click(function(){
                   if(Dom.top_nav.css('display') == 'none'){
                   	    Dom.nav_bottom.show();
                   	    Dom.top_nav.show();
                   }
                   else{
                   	    Dom.nav_bottom.hide();
                   	    Dom.top_nav.hide(); 
               	   	    Dom.font_container.hide();                   	                    	
                   }
               });
               Dom.font_button.click(function(){
               	   if(Dom.font_container.css('display') == 'none'){
               	   	  Dom.font_container.show();
               	   }
               	   else{
               	   	 Dom.font_container.hide();
               	   }
               })
               $('#night-button').click(function(){

               })
               $('#large-font').click(function(){
               	   if(initFontSize > 20){
               	   	return;
               	   }
                   initFontSize += 1;
                   RootContainer.css('font-size', initFontSize);
                   Util.StorageSetter('font_size', initFontSize);
               })
               $('#small-font').click(function(){
               	   if(initFontSize < 12){
               	   	return;
               	   }
                   initFontSize -= 1;
                   RootContainer.css('font-size', initFontSize);
                   Util.StorageSetter('font_size', initFontSize);
               })
               // console.log(Dom.bk_container[0]);
               // console.log($('#bk-container'));
               // // // console.log(Dom.body);
               // // alert('1');
               // // Dom.body.css('background','#000')
               // console.log($('.bk-container')[1]);
               $('#bk-container1').click(function(){
               	// console.log(bk_container[0]);
               	// console.log(body);
                   Dom.body.css('background','#e9dfc7');
                   Util.StorageSetter('background','#e9dfc7');
                   // alert('1');
               });
               $('#bk-container2').click(function(){
                   Dom.body.css('background','#a4a4a4');
                   Util.StorageSetter('background','#a4a4a4');
                   // alert('2');
               });
               $('#bk-container3').click(function(){
                   Dom.body.css('background','#cdedce');
                   Util.StorageSetter('background','#cdedce');
                   // alert('2');
               });
               $('#bk-container4').click(function(){
                   Dom.body.css('background','#283548');
                   Util.StorageSetter('background', '#283548');
                   // alert('2');
               });
               $('#bk-container5').click(function(){
                   Dom.body.css('background','#0f1410');
                   Util.StorageSetter('background', '#0f1410');
                   // console.log(Util.StorageGetter('background'));
                   // alert('2');
               });
               var NightMode = false;
               Dom.night_button.click(function(){
               	if(NightMode){
               		$('#icon-day').hide();
               		$('#icon-night').show();
               		NightMode = false;
               		Dom.body.css('background', '#e9dfc7');
               		// Util.StorageSetter('background', oldbackground);

               	}
               	else{
               		$('#icon-day').show();
               		$('#icon-night').hide();
               		NightMode = true;
               		Dom.body.css('background', '#000');
               	}
               });

               Win.scroll(function(){
                   	    Dom.nav_bottom.hide();
                   	    Dom.top_nav.hide();
               	   	 Dom.font_container.hide();
               });

               $('#prev_button').click(function(){
                   readerModel.prevChapter(function(data){
                   readerUI(data)
                   })
               });
               $('#next_button').click(function(){
                   readerModel.nextChapter(function(data){
                   readerUI(data)
                   })
               });
               $('#menu-button').click(function(){
                Dom.fiction_list.show();
                Dom.fiction_container_area.hide();
                Dom.action_mid.hide();
               });
               Dom.fiction_list.click(function(){
                Dom.fiction_container_area.show();  
                Dom.fiction_list.hide();
                Dom.action_mid.show();                             
               })
    		}

    		main();
    	})();
    </script>
</body>
</html>